# Automated pipeline to convert Open API Specification to Asana Postman collection and sync to workspace.
# [Internal Asanas] Learn more: https://app.asana.com/0/0/1211836466365216/f

name: Sync Postman Collection

on:
  # Temp start
  push:
    branches:
      - master
  # Temp end
  schedule:
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  deploy-to-postman:
    runs-on: ubuntu-latest

    env:
      POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
      POSTMAN_COLLECTION_ID: "47189562-a68d6105-882b-4ac2-8a05-69ad3c673c2d"
      # File name of the Postman collection json file to be created in defs directory
      POSTMAN_COLLECTION_FILE: "asana_postman_collection.json"

    steps:
      - name: Checkout repository üìö
        uses: actions/checkout@v5

      - name: Set up Python üêç
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      - name: Install Python dependencies üì¶
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml requests

      - name: Build Postman Collection from Open API Spec üèóÔ∏è
        run: python convert_oas_to_postman.py
      
      - name: Publish Postman Collection
        run: python update_postman_collection.py